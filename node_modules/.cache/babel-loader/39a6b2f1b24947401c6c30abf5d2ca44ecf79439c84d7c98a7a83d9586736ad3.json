{"ast":null,"code":"import { createAsyncThunk, createSlice } from \"@reduxjs/toolkit\";\nimport { root_url } from '../../global';\nimport produce from 'immer';\nconst initialState = {\n  list: []\n};\nexport const fetchProductByCategory = createAsyncThunk('ProductByCategory/fetchProductByCategory', async id => {\n  const response = await fetch(`${root_url}categories/${id}`);\n  const data = await response.json();\n  return data;\n});\nconst productByCategory_slice = createSlice({\n  name: 'products',\n  initialState,\n  reducers: {\n    sortProductCategory(state, action) {\n      console.log('sort', state.list.data);\n      if (action.payload === 'default') {\n        state.list.data.sort((a, b) => a.id - b.id);\n      } else if (action.payload === 'title') {\n        state.list.data.sort((a, b) => a.title.localeCompare(b.title));\n      } else if (action.payload === 'price_low') {\n        state.list.data.sort((a, b) => a.price - b.price);\n      } else if (action.payload === 'price_high') {\n        state.list.data.sort((a, b) => b.price - a.price);\n      }\n    },\n    filterProductCategory(state, action) {\n      const {\n        min_value,\n        max_value\n      } = action.payload;\n      console.log('filter', state.list.data);\n      state.list.data = state.list.data.map(el => ({\n        ...el,\n        show_product: true\n      }));\n      state.list.data = state.list.data.map(el => {\n        // Проверяем условие для min_value и max_value\n        const priceInRange = el.price >= min_value && el.price <= max_value;\n\n        // Обновляем show_product в зависимости от условия\n        return {\n          ...el,\n          show_product: priceInRange\n        };\n      });\n\n      // Сортировка массива в зависимости от новых значений show_product\n      state.list.data.sort((a, b) => {\n        if (a.show_product && !b.show_product) {\n          return -1;\n        } else if (!a.show_product && b.show_product) {\n          return 1;\n        } else {\n          // Если оба элемента имеют show_product: true или show_product: false, сохраняем текущий порядок\n          return 0;\n        }\n      });\n\n      // const filterData = [...state.data].map(el => {\n      //     if (el.price >= min_value && el.price <= max_value) {\n      //         el.show_product = true;\n      //     } else {\n      //         el.show_product = false;\n      //     }\n      //     return el\n      // });\n      // return { ...state, data: filterData }\n    },\n\n    getCheapProductCategory(state, action) {\n      if (action.payload) {\n        state.list = state.list.map(el => {\n          if (!el.discont_price) {\n            return {\n              ...el,\n              show_product: false\n            };\n          }\n          return el;\n        });\n      } else {\n        state.list = state.list.map(el => {\n          return {\n            ...el,\n            show_product: true\n          };\n        });\n      }\n    }\n  },\n  extraReducers: builder => {\n    builder.addCase(fetchProductByCategory.pending, state => {\n      //pending\n      state.status = 'loading';\n    }).addCase(fetchProductByCategory.fulfilled, (state, action) => {\n      //success\n      state.status = 'ready';\n      state.list = action.payload;\n    }).addCase(fetchProductByCategory.rejected, state => {\n      //rejected\n      state.status = 'error';\n    });\n  }\n});\nexport default productByCategory_slice.reducer;\nexport const {\n  sortProductCategory,\n  filterProductCategory,\n  getCheapProductCategory\n} = productByCategory_slice.actions;\nexport const selectProductsStatus = state => state.productByCategory_slice.status;","map":{"version":3,"names":["createAsyncThunk","createSlice","root_url","produce","initialState","list","fetchProductByCategory","id","response","fetch","data","json","productByCategory_slice","name","reducers","sortProductCategory","state","action","console","log","payload","sort","a","b","title","localeCompare","price","filterProductCategory","min_value","max_value","map","el","show_product","priceInRange","getCheapProductCategory","discont_price","extraReducers","builder","addCase","pending","status","fulfilled","rejected","reducer","actions","selectProductsStatus"],"sources":["/Users/anastasiakobyzeva/Desktop/ReactTest/ProjectTelRunToolkit/2808nelly/src/store/slices/productByCategory_slice.js"],"sourcesContent":["import { createAsyncThunk, createSlice } from \"@reduxjs/toolkit\"\nimport { root_url } from '../../global'\nimport produce from 'immer'\n\nconst initialState = {\n    list: [],\n}\n\nexport const fetchProductByCategory = createAsyncThunk(\n    'ProductByCategory/fetchProductByCategory',\n    async (id) => {\n        const response = await fetch(`${root_url}categories/${id}`);\n        const data = await response.json();\n        return data;\n    }\n)\n\nconst productByCategory_slice = createSlice({\n    name: 'products',\n    initialState,\n    reducers: {\n        sortProductCategory(state, action) {\n            console.log('sort', state.list.data)\n            if (action.payload === 'default') {\n                state.list.data.sort((a, b) => a.id - b.id);\n            } else if (action.payload === 'title') {\n                state.list.data.sort((a, b) => a.title.localeCompare(b.title));\n            } else if (action.payload === 'price_low') {\n                state.list.data.sort((a, b) => a.price - b.price);\n            } else if (action.payload === 'price_high') {\n                state.list.data.sort((a, b) => b.price - a.price);\n            }\n        },\n        filterProductCategory(state, action) {\n            const { min_value, max_value } = action.payload;\n            console.log('filter', state.list.data)\n            state.list.data = state.list.data.map((el) => ({\n                ...el,\n                show_product: true,\n            }));\n            state.list.data = state.list.data.map((el) => {\n                // Проверяем условие для min_value и max_value\n                const priceInRange = el.price >= min_value && el.price <= max_value;\n        \n                // Обновляем show_product в зависимости от условия\n                return {\n                    ...el,\n                    show_product: priceInRange,\n                };\n            });\n        \n            // Сортировка массива в зависимости от новых значений show_product\n            state.list.data.sort((a, b) => {\n                if (a.show_product && !b.show_product) {\n                    return -1;\n                } else if (!a.show_product && b.show_product) {\n                    return 1;\n                } else {\n                    // Если оба элемента имеют show_product: true или show_product: false, сохраняем текущий порядок\n                    return 0;\n                }\n            });\n\n            // const filterData = [...state.data].map(el => {\n            //     if (el.price >= min_value && el.price <= max_value) {\n            //         el.show_product = true;\n            //     } else {\n            //         el.show_product = false;\n            //     }\n            //     return el\n            // });\n            // return { ...state, data: filterData }\n        },\n        getCheapProductCategory(state, action) {\n            if (action.payload) {\n                state.list = state.list.map(el => {\n                    if (!el.discont_price) {\n                        return { ...el, show_product: false };\n                    }\n                    return el;\n                });\n            } else {\n                state.list = state.list.map(el => {\n                    return { ...el, show_product: true };\n                });\n            }\n        },\n    },\n    extraReducers: (builder) => {\n        builder\n            .addCase(fetchProductByCategory.pending, (state) => {    //pending\n                state.status = 'loading'\n            })\n            .addCase(fetchProductByCategory.fulfilled, (state, action) => {   //success\n                state.status = 'ready'\n                state.list = action.payload\n            })\n            .addCase(fetchProductByCategory.rejected, (state) => {   //rejected\n                state.status = 'error'\n            })\n    }\n})\n\nexport default productByCategory_slice.reducer;\nexport const { sortProductCategory, filterProductCategory, getCheapProductCategory } = productByCategory_slice.actions;\nexport const selectProductsStatus = (state) => state.productByCategory_slice.status;"],"mappings":"AAAA,SAASA,gBAAgB,EAAEC,WAAW,QAAQ,kBAAkB;AAChE,SAASC,QAAQ,QAAQ,cAAc;AACvC,OAAOC,OAAO,MAAM,OAAO;AAE3B,MAAMC,YAAY,GAAG;EACjBC,IAAI,EAAE;AACV,CAAC;AAED,OAAO,MAAMC,sBAAsB,GAAGN,gBAAgB,CAClD,0CAA0C,EAC1C,MAAOO,EAAE,IAAK;EACV,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAAE,GAAEP,QAAS,cAAaK,EAAG,EAAC,CAAC;EAC3D,MAAMG,IAAI,GAAG,MAAMF,QAAQ,CAACG,IAAI,CAAC,CAAC;EAClC,OAAOD,IAAI;AACf,CACJ,CAAC;AAED,MAAME,uBAAuB,GAAGX,WAAW,CAAC;EACxCY,IAAI,EAAE,UAAU;EAChBT,YAAY;EACZU,QAAQ,EAAE;IACNC,mBAAmBA,CAACC,KAAK,EAAEC,MAAM,EAAE;MAC/BC,OAAO,CAACC,GAAG,CAAC,MAAM,EAAEH,KAAK,CAACX,IAAI,CAACK,IAAI,CAAC;MACpC,IAAIO,MAAM,CAACG,OAAO,KAAK,SAAS,EAAE;QAC9BJ,KAAK,CAACX,IAAI,CAACK,IAAI,CAACW,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKD,CAAC,CAACf,EAAE,GAAGgB,CAAC,CAAChB,EAAE,CAAC;MAC/C,CAAC,MAAM,IAAIU,MAAM,CAACG,OAAO,KAAK,OAAO,EAAE;QACnCJ,KAAK,CAACX,IAAI,CAACK,IAAI,CAACW,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKD,CAAC,CAACE,KAAK,CAACC,aAAa,CAACF,CAAC,CAACC,KAAK,CAAC,CAAC;MAClE,CAAC,MAAM,IAAIP,MAAM,CAACG,OAAO,KAAK,WAAW,EAAE;QACvCJ,KAAK,CAACX,IAAI,CAACK,IAAI,CAACW,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKD,CAAC,CAACI,KAAK,GAAGH,CAAC,CAACG,KAAK,CAAC;MACrD,CAAC,MAAM,IAAIT,MAAM,CAACG,OAAO,KAAK,YAAY,EAAE;QACxCJ,KAAK,CAACX,IAAI,CAACK,IAAI,CAACW,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKA,CAAC,CAACG,KAAK,GAAGJ,CAAC,CAACI,KAAK,CAAC;MACrD;IACJ,CAAC;IACDC,qBAAqBA,CAACX,KAAK,EAAEC,MAAM,EAAE;MACjC,MAAM;QAAEW,SAAS;QAAEC;MAAU,CAAC,GAAGZ,MAAM,CAACG,OAAO;MAC/CF,OAAO,CAACC,GAAG,CAAC,QAAQ,EAAEH,KAAK,CAACX,IAAI,CAACK,IAAI,CAAC;MACtCM,KAAK,CAACX,IAAI,CAACK,IAAI,GAAGM,KAAK,CAACX,IAAI,CAACK,IAAI,CAACoB,GAAG,CAAEC,EAAE,KAAM;QAC3C,GAAGA,EAAE;QACLC,YAAY,EAAE;MAClB,CAAC,CAAC,CAAC;MACHhB,KAAK,CAACX,IAAI,CAACK,IAAI,GAAGM,KAAK,CAACX,IAAI,CAACK,IAAI,CAACoB,GAAG,CAAEC,EAAE,IAAK;QAC1C;QACA,MAAME,YAAY,GAAGF,EAAE,CAACL,KAAK,IAAIE,SAAS,IAAIG,EAAE,CAACL,KAAK,IAAIG,SAAS;;QAEnE;QACA,OAAO;UACH,GAAGE,EAAE;UACLC,YAAY,EAAEC;QAClB,CAAC;MACL,CAAC,CAAC;;MAEF;MACAjB,KAAK,CAACX,IAAI,CAACK,IAAI,CAACW,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAK;QAC3B,IAAID,CAAC,CAACU,YAAY,IAAI,CAACT,CAAC,CAACS,YAAY,EAAE;UACnC,OAAO,CAAC,CAAC;QACb,CAAC,MAAM,IAAI,CAACV,CAAC,CAACU,YAAY,IAAIT,CAAC,CAACS,YAAY,EAAE;UAC1C,OAAO,CAAC;QACZ,CAAC,MAAM;UACH;UACA,OAAO,CAAC;QACZ;MACJ,CAAC,CAAC;;MAEF;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACJ,CAAC;;IACDE,uBAAuBA,CAAClB,KAAK,EAAEC,MAAM,EAAE;MACnC,IAAIA,MAAM,CAACG,OAAO,EAAE;QAChBJ,KAAK,CAACX,IAAI,GAAGW,KAAK,CAACX,IAAI,CAACyB,GAAG,CAACC,EAAE,IAAI;UAC9B,IAAI,CAACA,EAAE,CAACI,aAAa,EAAE;YACnB,OAAO;cAAE,GAAGJ,EAAE;cAAEC,YAAY,EAAE;YAAM,CAAC;UACzC;UACA,OAAOD,EAAE;QACb,CAAC,CAAC;MACN,CAAC,MAAM;QACHf,KAAK,CAACX,IAAI,GAAGW,KAAK,CAACX,IAAI,CAACyB,GAAG,CAACC,EAAE,IAAI;UAC9B,OAAO;YAAE,GAAGA,EAAE;YAAEC,YAAY,EAAE;UAAK,CAAC;QACxC,CAAC,CAAC;MACN;IACJ;EACJ,CAAC;EACDI,aAAa,EAAGC,OAAO,IAAK;IACxBA,OAAO,CACFC,OAAO,CAAChC,sBAAsB,CAACiC,OAAO,EAAGvB,KAAK,IAAK;MAAK;MACrDA,KAAK,CAACwB,MAAM,GAAG,SAAS;IAC5B,CAAC,CAAC,CACDF,OAAO,CAAChC,sBAAsB,CAACmC,SAAS,EAAE,CAACzB,KAAK,EAAEC,MAAM,KAAK;MAAI;MAC9DD,KAAK,CAACwB,MAAM,GAAG,OAAO;MACtBxB,KAAK,CAACX,IAAI,GAAGY,MAAM,CAACG,OAAO;IAC/B,CAAC,CAAC,CACDkB,OAAO,CAAChC,sBAAsB,CAACoC,QAAQ,EAAG1B,KAAK,IAAK;MAAI;MACrDA,KAAK,CAACwB,MAAM,GAAG,OAAO;IAC1B,CAAC,CAAC;EACV;AACJ,CAAC,CAAC;AAEF,eAAe5B,uBAAuB,CAAC+B,OAAO;AAC9C,OAAO,MAAM;EAAE5B,mBAAmB;EAAEY,qBAAqB;EAAEO;AAAwB,CAAC,GAAGtB,uBAAuB,CAACgC,OAAO;AACtH,OAAO,MAAMC,oBAAoB,GAAI7B,KAAK,IAAKA,KAAK,CAACJ,uBAAuB,CAAC4B,MAAM"},"metadata":{},"sourceType":"module","externalDependencies":[]}